name: Update Recent Articles

on:
  schedule:
    - cron: '0 0 * * 0' # Runs weekly on Sunday at midnight UTC
  workflow_dispatch: # Allows manual triggering of the workflow

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Setup Node.js Environment
        uses: actions/setup-node@v3
        with:
          node-version: '16' # Ensure a compatible Node.js version is used

      - name: Fetch Latest Medium Posts
        run: |
          # Install dependencies
          npm install node-fetch@2

          # Fetch Medium posts and update README
          node <<EOF
          const fetch = require('node-fetch'); // Import fetch for Medium API
          const fs = require('fs');

          const mediumUsername = "ssatish.gonella"; // Replace with your Medium username
          const mediumURL = \`https://api.rss2json.com/v1/api.json?rss_url=https://medium.com/feed/@\${mediumUsername}\`;

          (async () => {
              try {
                  const response = await fetch(mediumURL);
                  const data = await response.json();

                  if (!data.items) {
                      console.error("No articles found");
                      return;
                  }

                  const articles = data.items.slice(0, 3).map((item) => `- [${item.title}](${item.link})`).join('\\n');
                  const readmeContent = fs.readFileSync('README.md', 'utf8');
                  const updatedReadme = readmeContent.replace(/## ðŸ“š Recent Articles\\n([\\s\\S]*?)\\n##/m, `## ðŸ“š Recent Articles\\n${articles}\\n##`);

                  fs.writeFileSync('README.md', updatedReadme);
              } catch (error) {
                  console.error("Error updating README:", error);
              }
          })();
          EOF

      - name: Commit and Push Changes
        run: |
          git config user.name "GitHub Actions Bot"
          git config user.email "actions@github.com"
          git add README.md
          git commit -m "Update Recent Articles" || echo "No changes to commit"
          git push
